<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, minimum-scale=1.0">
<title>Skill Testing Markup</title>

	<meta name="description" content="Complete Guide to Skill Testing ML">


<link rel="icon" href="/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,400i,500,500i,700,700i|Noto+Sans:400,400i,700,700i|Source+Code+Pro&amp;subset=latin-ext">
<link rel="stylesheet" href="/doks-theme/assets/css/style.css">
	</head>
	<body class="yellow" data-spy="scroll" data-target=".js-scrollspy">
		
	<div class="offcanvas visible-xs">
		<ul class="offcanvas__nav">
			
				<li><a href="#">Item 1</a></li>
			
				<li><a href="#">Item 2</a></li>
			
				<li><a href="#">Item 3</a></li>
			
		</ul><!-- /.offcanvas__nav -->
	</div><!-- /.offcanvas -->



	<header class="site-header">
		<div class="container">
			<div class="row">
				<div class="col-xs-12">
					
						<a href="/" class="site-header__logo">Bespoken Documentation</a>
					
					
						<ul class="site-header__nav hidden-xs">
							
								<li><a href="#">Item 1</a></li>
							
								<li><a href="#">Item 2</a></li>
							
								<li><a href="#">Item 3</a></li>
							
						</ul><!-- /.site-header__nav -->
						<button class="offcanvas-toggle visible-xs">
							<span></span>
							<span></span>
							<span></span>
						</button><!-- /.offcanvas-toggle -->
					
				</div><!-- /.col -->
			</div><!-- /.row -->
		</div><!-- /.container -->
	</header><!-- /.site-header -->


		<div class="hero-subheader">
			<div class="container">
				<div class="row">
					<div class="col-md-7">
						<div class="align-container" data-mh>
							<div class="align-inner">
								
									<h1 class="hero-subheader__title">Skill Testing Markup</h1>
								
								
									<p class="hero-subheader__desc">Complete Guide to Skill Testing ML</p>
								
								
									
										<a href="#" class="btn btn--dark btn--rounded btn--w-icon btn--w-icon-left">
											<i class="icon icon--arrow-left"></i>
											Previous page
										</a>
									
									
										<a href="#" class="btn btn--dark btn--rounded btn--w-icon">
											<i class="icon icon--arrow-right"></i>
											Next page
										</a>
									
								
							</div><!-- /.align-inner -->
						</div><!-- /.align-container -->
					</div><!-- /.col -->
					
				</div><!-- /.row -->
			</div><!-- /.container -->
		</div><!-- /.hero-subheader -->
		<div class="section">
			<div class="container">
				<div class="row">
					<div class="col-md-7">
						<div class="content">
							<h1 id="complete-skill-testing-guide">Complete Skill Testing Guide</h1>

<h2 id="overview">Overview</h2>
<p>The purpose of the Skill Testing Markup Language is to make it easy for anyone to test Alexa skills and voice apps.</p>

<p>The syntax is based on YAML, and is meant to be easy to read and write. <a href="http://yaml.org/spec/1.2/spec.html#Preview">Learn more about YAML syntax here</a>.</p>

<p>The tests are actually run with specialized version of Jest.
Jest is an excellent testing tool, that combines unit tests, code coverage, easy-to-use mocks and other nice features in one place.
<a href="https://facebook.github.io/jest/">Learn more here</a>.</p>

<p>Jest has been configured with a custom test runner, which:</p>
<ul>
  <li>Works with YAML files, fitting the structure described here</li>
  <li>Runs using our <a href="https://github.com/bespoken/virtual-alexa">Virtual Alexa component</a> to generate JSON requests and emulate Alexa behavior</li>
</ul>

<p>We consider this the best of all worlds - a full-featured general testing framework tailored to work specifically with skills.</p>

<h3 id="nota-bene">Nota Bene</h3>
<p><strong>KEEP IN MIND</strong> the skill tester uses Virtual Alexa, which is an emulator. It is not the real Alexa. This has some benefits, such as:</p>

<ul>
  <li>Fast execution time</li>
  <li>No need for deployment to run</li>
  <li>Minimal dependencies, and with builtin mocks that are useful</li>
</ul>

<p>But there are also limitations. Those include:</p>

<ul>
  <li>It does not have real speech recognition - turning utterances into intents is done with simple heuristics</li>
  <li>It cannot call the actual Alexa APIs, such as the Address API, because it does not generate a proper apiAccessToken</li>
  <li>It is emulating Alexa, and may do it imperfectly at times (and let us know if you see any issues)</li>
</ul>

<p>If you run into issues with testing specific utterances, always keep in mind you can set the exact intent and slot values with the intent and slot properties.</p>

<h2 id="configuration">Configuration</h2>
<p>Global configuration options for testing skills can be set in the file</p>

<p>These options can include overriding Jest options, as well as setting skill testing specific ones.</p>

<p>The default Jest settings are as follows:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    "collectCoverage": true,
    "collectCoverageFrom": [
        "**/*.js",
        "!**/coverage/**",
        "!**/node_modules/**",
        "!**/vendor/**"
    ],
    "coverageDirectory": "./coverage/",
    "moduleFileExtensions": [
        "ts",
        "js",
        "yml"
    ],
    "silent": false,
    "testMatch: ["**/test/*.yml", "**/tests/*.yml", "**/*.test.yml", "**/*.spec.yml"],
    "verbose": true
}
</code></pre></div></div>

<p><a href="https://facebook.github.io/jest/docs/en/configuration.html">Learn what these do here</a>.</p>

<p>An example <code class="highlighter-rouge">bst.json</code> file:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    "handler": "src/index.handler",
    "locale": "de-DE",
    "interactionModel": "models/de-DE.json",
    "trace": true,
    "jest": {
        "silent": true
    }
}
</code></pre></div></div>

<p>The handler, interactionModel and trace options are specific to testing.</p>

<ul>
  <li>handler - The path to the handler (and function name) to run the test</li>
  <li>interactionModel - The path to the interaction model to use for the test</li>
  <li>locale - The locale to be used</li>
  <li>trace - Causes request and response JSON payloads from the skill to be printed to the console</li>
</ul>

<p>To override <a href="https://facebook.github.io/jest/docs/en/configuration.html">Jest options</a>, just set them under the “jest” key.</p>

<h2 id="cli-options">CLI Options</h2>
<p>When invoking <code class="highlighter-rouge">bst test</code>, the name of a specific test to run can be passed, like this:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bst test test/MyIntent.test.yml
</code></pre></div></div>

<h2 id="test-structure">Test Structure</h2>
<p>The test syntax is based on YAML.</p>

<p>When running <code class="highlighter-rouge">bst test</code>, it automatically searches for files with the following names:</p>

<ul>
  <li><em>*/test/**/</em>.yml</li>
  <li><em>*/</em>.test.yml</li>
  <li><em>*/</em>.spec.yml</li>
</ul>

<p>Any tests that match these patterns will be run.
A recommended convention is to sort test files under a test dir.</p>

<h3 id="test-suites">Test Suites</h3>
<p>Each test file is a test suite. Test suites are made up of one or many tests.</p>

<p>The tests represent discreet conversations with Alexa. Each test can have one or many interactions - here is a simple example:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
configuration:
  locale: en-US
---
- test: "Sequence 01. Test scenario: launch request, no further interaction."
- LaunchRequest: # LaunchRequest is not an utterance but a request type and "reserved" word
  - response.outputSpeech.ssml: "Here's your fact"
  - response.card.type: "Simple"
  - response.card.title: "Space Facts"
  - response.card.content: "/.*/" # Regular expression indicating any text will match

---
- test: "Sequence 02. Test scenario: GetNewFactIntent with different utterances."
- "ask space facts to tell me a space fact":
  - response.outputSpeech.ssml: "/here's your fact.*/i"
  - response.card.type: "Simple"
  - response.card.title: "Space Facts"
  - response.card.content: "/.*/"
- "tell space facts to give me fact":
  - response.outputSpeech.ssml: "/here's your fact.*/i"
  - response.card.type: "Simple"
  - response.card.title: "Space Facts"
  - response.card.content: "/.*/"
</code></pre></div></div>

<p>The test suite above contains two tests. Additionally, at the top it has a configuration element.</p>

<p>The configuration provides settings that work across the test - <a href="#test-configuration">it is described below</a>.</p>

<p>The tests represent sequence of conversations with the skill.</p>

<p>They can use specific requests (such as LaunchRequest or SessionEndedRequest), or they can simply be an utterance.</p>

<h3 id="test-configuration">Test Configuration</h3>
<p>The test configuration can override elements set in the global skill testing configuration.</p>

<p>It can also set test-suite specific items such as:</p>

<ul>
  <li>address: Should be set with address attributes to emulate results from the Address API - <a href="./use-cases#testing-with-the-address-api">more info here</a>.</li>
  <li>applicationId: Sets the applicationId to be used in the generated requests</li>
  <li>deviceId: Sets the deviceId to be used in the generated requests</li>
  <li>dynamo: Should be set to “mock” to use the mock dynamo component - <a href="./use-cases#testing-with-dynamo">more info here</a>.</li>
  <li>userId: Sets the userId to be used in the generated requests</li>
</ul>

<h3 id="test-structure-1">Test Structure</h3>
<p>The start of a test is marked with three dashes on a line - <code class="highlighter-rouge">---</code>.</p>

<p>It can be followed by an optional test description, which looks like this:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- test: "Description of my test"
</code></pre></div></div>

<p>This description, if provided, must be the first line in the test.</p>

<p>The test is then made up of a series of interactions and assertions.</p>

<p>Each interaction is prefixed with a “-“ which indicates a YAML colletion.</p>

<p>After each interaction, comes a series of expressions. Typically, these are assertions about the test.
But they can be:</p>

<ul>
  <li><a href="#assertions">Assertions</a>: The life-blood of tests - statements about the expected output</li>
  <li><a href="#request-expressions">Request Expressions</a>: Allow for setting values on the request - helpful for testing more complex cases</li>
  <li><a href="#intent-and-slot-properties">Intent and Slot Properties</a>: Allow for specifically setting the intents and slots. Bypasses mapping the utterance to the intent and slot.</li>
</ul>

<p>For each interaction, there can be many assertions and request expressions.
There is not a limit on how much can be tested!</p>

<p>When tests are run, each interaction is processed in order. Within it,
each assertion is in turn evaluated in order when a response is received.</p>

<p>If any assertion fails for a test, the test stops processing, and information about the failed assertion is provided.</p>

<h3 id="assertions">Assertions</h3>
<p>An assertion follows one of two simple syntaxes:<br />
<code class="highlighter-rouge">[JSONPath Property]: [Expected Value]</code> <br />
or<br />
<code class="highlighter-rouge">[JSONPath Property] [Operator] [Expected Value]</code></p>

<p>The second syntax provides use more than just equality operators.</p>

<p>The operators are:</p>

<ul>
  <li>== Partial equals - for example, the expected value “partial sentence” will match “this is a partial sentence”</li>
  <li>=~ Regular expression match</li>
  <li>!= Not equal to</li>
  <li>&gt;  Greater than</li>
  <li>&gt;= Greater than or equal</li>
  <li>&lt;  Less than</li>
  <li>&lt;= Less than or equal</li>
</ul>

<p>Additionally, the <code class="highlighter-rouge">:</code> operator is the same as == or =~, depending on whether the expected value is a regular expression.</p>

<p>We use JSONPath to get values from the response, such as:
<code class="highlighter-rouge">response.outputSpeech.ssml</code></p>

<p>This will return the value: “My SSML Value” from the following JSON response:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
    "response": {
        "outputSpeech": {
            "ssml": "My SSML value"
         }
    }
}
</code></pre></div></div>

<p>The expected value can be:</p>

<ul>
  <li>A string - quote or unquoted</li>
  <li>A number</li>
  <li><code class="highlighter-rouge">true</code> or <code class="highlighter-rouge">false</code></li>
  <li>A regular expression - should be denoted with slashes (/this .* that/)</li>
  <li><code class="highlighter-rouge">undefined</code> - special value indicating not defined</li>
</ul>

<h4 id="jsonpath-properties">JSONPath Properties</h4>
<p>JSONPath is an incredibly expressive way to get values from a JSON object.</p>

<p>You can play around with <a href="http://jsonpath.com/">how it works here</a>.</p>

<p>Besides handling basic properties, it can also navigate arrays and apply conditions.</p>

<p>An array example:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
     "directives": [
      {
        "type": "AudioPlayer.Play",
        "playBehavior": "ENQUEUE",
        "audioItem": {
          "stream": {
            "token": "this-is-the-audio-token",
            "url": "https://my-audio-hosting-site.com/audio/sample-song.mp3",
            "offsetInMilliseconds": 0
          }
        }
      }
    ]
}
</code></pre></div></div>

<p><code class="highlighter-rouge">directives[0].type == "AudioPlayer.Play"</code></p>

<h4 id="shorthand-properties">Shorthand Properties</h4>
<p>For certain commonly accessed elements, we offer short-hand properties for referring to them. These are:</p>

<ul>
  <li>prompt - Grabs either the text or ssml from <code class="highlighter-rouge">response.outputSpeech</code>, whichever one is set</li>
  <li>reprompt - Grabs either the text or ssml from <code class="highlighter-rouge">response.reprompt.outputSpeech</code>, which one is set</li>
</ul>

<p>Example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- test: "My Fact Skill"
- LaunchRequest:
  - prompt: "Here's your fact"
</code></pre></div></div>

<p>The <code class="highlighter-rouge">prompt</code> property is also used by the Dialog Interface. <a href="./use_cases#testing-with-the-dialog-interface">More information on that here</a>.</p>
<h4 id="regular-expression-values">Regular Expression Values</h4>
<p>The expected value can be a regular expression.</p>

<p>If it follows a “:”, it must be in the form of /my regular expression/ like this:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- response.outputSpeech.ssml: /hello, .*, welcome/i
</code></pre></div></div>

<p>Regular expression flags are also supported with this syntax, such as /case insensitive/i.
They are <a href="https://javascript.info/regexp-introduction#flags">described here in more detail</a>.</p>

<h4 id="collection-values">Collection Values</h4>
<p>It is also possible to specify multiple valid values for a property.</p>

<p>That is done with a collection of expected values, such as this:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"open howdy"
  - response.outputSpeech.ssml:
    - Hi there
    - Howdy
    - How are you?
</code></pre></div></div>

<p>When a collection is used like this, if any of the values matches, the assertion will be considered a success.</p>

<h3 id="intent-and-slot-properties">Intent and Slot properties</h3>
<p>Though it is convenient to use the utterance syntax, some times it may not work correctly.</p>

<p>It also is useful to be explicit at times about which intents and slots are desired.</p>

<p>To do that, set a test like so:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- "Some utterance"
  - intent: SomeIntent
  - slots:
      SlotA: ValueA
      SlotB: ValueB
</code></pre></div></div>

<p>This interaction will send an IntentRequest with the intent name SomeIntent and slots SlotA and SlotB set to ValueA and ValueB respectively.</p>

<p>Easy, right? The utterance is ignored, but can be useful a form of description.</p>

<h3 id="request-expressions">Request Expressions</h3>
<p>Request expressions allow for setting values explicitly on the request to handler more complex cases.</p>

<p>For example, to set a request attribute explicity in a certain way, just write:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>- "Some utterance"
  - request.session.attributes.myKey: myValue
</code></pre></div></div>

<p>This will set the value of <code class="highlighter-rouge">myKey</code> to <code class="highlighter-rouge">myValue</code>.</p>

<p>The left-hand part of the expression uses JSONPath, same as the assertion.</p>

<p>Note that all request expressions MUST start with request, and when they are setting part of the request element, it will appears redundant:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>request.request.locale: en-US
</code></pre></div></div>

<h3 id="goto-and-exit">Goto And Exit</h3>
<p>One advanced feature is support for <code class="highlighter-rouge">goto</code> and <code class="highlighter-rouge">exit</code>.</p>

<p>Goto comes at the end of an assertion - if the assertion is true, the test will “jump” to the utterance named.
Unlike regular assertions, ones that end in “goto” will not be deemed a failure if the comparison part of the assertion is not true.</p>

<p>For example:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>---
- test: "Goes to successfully"
- LaunchRequest:
  - response.outputSpeech.ssml == "Here's your fact:*" goto Get New Fact
  - response.reprompt == undefined
  - response.card.content =~ /.*/
  - exit
- Help:
  - response.outputSpeech.ssml == "Here's your fact:*"
  - response.reprompt == undefined
  - response.card.content =~ /.*/
- Get New Fact:
  - response.outputSpeech.ssml == "ABC"
  - response.reprompt == undefined
  - response.card.content =~ /.*/
</code></pre></div></div>

<p>In this case, if the outputSpeech starts with “Here’s your fact”,
the test will jump to the last interaction and say “Get New Fact”.</p>

<p>If the outputSpeech does not start with “Get New Fact”, the other assertions will be evaluated.
The test will end when it reaches the <code class="highlighter-rouge">exit</code> statement at the end (no further interactions will be processed).</p>

<p>Using <code class="highlighter-rouge">goto</code> and <code class="highlighter-rouge">exit</code>, more complex tests can be built.</p>

<h2 id="further-reading">Further Reading</h2>
<p>Take a look at:</p>
<ul>
  <li>Our <a href="use_cases">use cases</a></li>
  <li>Our <a href="best_practices">best practices</a></li>
  <li>Our <a href="get_started">getting started guide</a></li>
</ul>

<p>And don’t hesitate to reach out via <a href="https://gitter.im/bespoken/bst">Gitter</a>.</p>

						</div><!-- /.content -->
					</div><!-- /.col -->
					<div class="col-md-4 col-md-offset-1">
						<div class="sections-list-wrapper">
							<div class="sections-list js-sections js-affix js-scrollspy hidden-xs hidden-sm"></div><!-- /.sections-list -->
						</div>
					</div><!-- /.col -->
				</div><!-- /.row -->
			</div><!-- /.container -->
		</div><!-- /.section -->
		
		<div class="js-footer-area">
			
				<nav class="page-nav">
					<div class="container">
						<div class="row">
							<div class="col-xs-12">
								
									<a href="#" class="page-nav__item page-nav__item--prev">
										<i class="icon icon--arrow-left"></i>
										Previous page
									</a><!-- /.page-nav__item -->
								
								
									<a href="#" class="page-nav__item page-nav__item--next">
										Next page
										<i class="icon icon--arrow-right"></i>
									</a><!-- /.page-nav__item -->
								
							</div><!-- /.col -->
						</div><!-- /.row -->
					</div><!-- /.container -->
				</nav><!-- /.page-nav -->
			
			
				<div class="micro-nav">
	<div class="container">
		<div class="row">
			<div class="col-xs-12">
				<a href="/" class="micro-nav__back">
					<i class="icon icon--arrow-left"></i>
					Back to homepage
				</a><!-- /.micro-nav__back -->
			</div><!-- /.col -->
		</div><!-- /.row -->
	</div><!-- /.container -->
</div><!-- /.micro-nav -->

			
			
	<footer class="site-footer">
		<div class="container">
			<div class="row">
				<div class="col-sm-6">
					
						<a href="/" class="site-footer__logo">Bespoken Docs</a>
					
					
						<hr>
						<p class="site-footer__copyright">Copyright &copy; 2017. - Project name <br>All rights reserved.</p>
					
				</div><!-- /.col -->
				
					<div class="col-sm-6 align-right">
						<ul class="social-list">
							
								<li>
									<a href="#" target="_blank" class="social-list__item social-list__item--facebook">
										<i class="icon icon--facebook"></i>
									</a>
								</li>
							
								<li>
									<a href="#" target="_blank" class="social-list__item social-list__item--twitter">
										<i class="icon icon--twitter"></i>
									</a>
								</li>
							
								<li>
									<a href="#" target="_blank" class="social-list__item social-list__item--instagram">
										<i class="icon icon--instagram"></i>
									</a>
								</li>
							
								<li>
									<a href="#" target="_blank" class="social-list__item social-list__item--youtube">
										<i class="icon icon--youtube"></i>
									</a>
								</li>
							
						</ul><!-- /.social-list -->
					</div><!-- /.col -->
				
			</div><!-- /.row -->
		</div><!-- /.container -->
	</footer><!-- /.site-footer -->


<script src="/doks-theme/assets/js/vendor/jquery.min.js"></script>
<script type="text/javascript" src="/doks-theme/assets/js/vendor/bootstrap/affix.min.js"></script>
<script type="text/javascript" src="/doks-theme/assets/js/vendor/bootstrap/scrollspy.min.js"></script>
<script type="text/javascript" src="/doks-theme/assets/js/vendor/matchHeight.min.js"></script>
<script type="text/javascript" src="/doks-theme/assets/js/scripts.min.js"></script>




		</div><!-- /.js-footer-area -->
	</body>
</html>
